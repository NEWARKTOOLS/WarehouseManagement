{% extends "base.html" %}

{% block title %}{{ 'Edit' if location else 'New' }} Location{% endblock %}

{% block content %}
<div class="container-fluid px-3 px-md-4">
    <div class="page-header">
        <h1>{{ 'Edit Location' if location else 'New Location' }}</h1>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card">
                <div class="card-body">
                    <form method="POST">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Location Code *</label>
                                <input type="text" class="form-control" name="code" value="{{ location.code if location else '' }}" {{ 'readonly' if location else 'required' }} style="text-transform: uppercase;">
                            </div>
                            <div class="col-md-8">
                                <label class="form-label">Name *</label>
                                <input type="text" class="form-control" name="name" value="{{ location.name if location else '' }}" required>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Location Type</label>
                                <select class="form-select" name="location_type">
                                    <option value="">Select type...</option>
                                    <option value="container" {% if location and location.location_type == 'container' %}selected{% endif %}>Container</option>
                                    <option value="outdoor" {% if location and location.location_type == 'outdoor' %}selected{% endif %}>Outdoor Building</option>
                                    <option value="upstairs" {% if location and location.location_type == 'upstairs' %}selected{% endif %}>Upstairs Warehouse</option>
                                    <option value="rack" {% if location and location.location_type == 'rack' %}selected{% endif %}>Racking</option>
                                    <option value="pallet" {% if location and location.location_type == 'pallet' %}selected{% endif %}>Pallet Position</option>
                                    <option value="bulk" {% if location and location.location_type == 'bulk' %}selected{% endif %}>Bulk Storage</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Zone</label>
                                <div class="input-group">
                                    <select class="form-select" id="zoneSelect" onchange="selectZone(this)">
                                        <option value="">Select existing or type new...</option>
                                        {% for zone in zones %}
                                        <option value="{{ zone }}" {% if location and location.zone == zone %}selected{% endif %}>{{ zone }}</option>
                                        {% endfor %}
                                        <option value="__new__">+ Add New Zone</option>
                                    </select>
                                    <input type="text" class="form-control" name="zone" id="zoneInput" value="{{ location.zone if location else '' }}" placeholder="New zone" style="text-transform: uppercase; {% if location and location.zone in zones %}display: none;{% endif %}">
                                </div>
                            </div>

                            <div class="col-4">
                                <label class="form-label">Row</label>
                                <input type="text" class="form-control" name="row" value="{{ location.row if location else '' }}">
                            </div>
                            <div class="col-4">
                                <label class="form-label">Bay</label>
                                <input type="text" class="form-control" name="bay" value="{{ location.bay if location else '' }}">
                            </div>
                            <div class="col-4">
                                <label class="form-label">Shelf</label>
                                <input type="text" class="form-control" name="shelf" value="{{ location.shelf if location else '' }}">
                            </div>

                            <div class="col-12">
                                <label class="form-label">Description</label>
                                <textarea class="form-control" name="description" rows="2">{{ location.description if location else '' }}</textarea>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label">Capacity Unit</label>
                                <select class="form-select" name="capacity_units">
                                    <option value="pallets" {% if location and location.capacity_units == 'pallets' %}selected{% endif %}>Pallets</option>
                                    <option value="boxes" {% if location and location.capacity_units == 'boxes' %}selected{% endif %}>Boxes</option>
                                    <option value="units" {% if location and location.capacity_units == 'units' %}selected{% endif %}>Units</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">Max Capacity</label>
                                <input type="number" class="form-control" name="max_capacity" value="{{ location.max_capacity if location else 0 }}" step="1">
                            </div>
                        </div>

                        <div class="d-flex gap-2 mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="bi bi-check-lg me-1"></i> {{ 'Update' if location else 'Create' }} Location
                            </button>
                            <a href="{{ url_for('locations.location_list') }}" class="btn btn-outline-secondary">Cancel</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function selectZone(select) {
    const input = document.getElementById('zoneInput');
    if (select.value === '__new__' || select.value === '') {
        input.style.display = '';
        input.focus();
        if (select.value === '__new__') {
            input.value = '';
        }
    } else {
        input.style.display = 'none';
        input.value = select.value;
    }
}

// On page load, sync input with select
document.addEventListener('DOMContentLoaded', function() {
    const select = document.getElementById('zoneSelect');
    const input = document.getElementById('zoneInput');
    if (select.value && select.value !== '__new__') {
        input.value = select.value;
        input.style.display = 'none';
    }
});
</script>
{% endblock %}
